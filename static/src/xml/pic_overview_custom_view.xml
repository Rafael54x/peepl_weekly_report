<?xml version="1.0" encoding="utf-8"?>
<templates>
    <t t-name="peepl_weekly_report.PicOverviewCustomView" owl="1">
        <div class="o_action_manager">
            <div class="o_list_view o_view_controller o_action">
                <!-- Control Panel -->
                <div class="o_control_panel d-flex flex-column gap-3 px-3 pt-2 pb-3" data-command-category="actions">
                    <div class="o_control_panel_main d-flex flex-wrap flex-lg-nowrap justify-content-between align-items-lg-start gap-2 gap-lg-3 flex-grow-1">
                        <!-- Left: Update Button + Title -->
                        <div class="o_control_panel_breadcrumbs d-flex align-items-center gap-1 order-0 h-lg-100">
                            <div class="o_control_panel_main_buttons d-flex gap-1 d-empty-none d-print-none">
                                <button type="button" class="btn btn-primary" t-on-click="() => this.updateStats()" t-att-disabled="state.updating">
                                    <i t-if="state.updating" class="fa fa-spinner fa-spin"></i>
                                    <span t-if="!state.updating">Update</span>
                                    <span t-if="state.updating">Updating...</span>
                                </button>
                            </div>
                            <div class="o_breadcrumb d-flex gap-1 text-truncate">
                                <div class="o_last_breadcrumb_item active d-flex fs-4 min-w-0 align-items-center">
                                    <span class="min-w-0 text-truncate">PIC Overview</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Center: Filters -->
                        <div class="d-flex align-items-center justify-content-center gap-3 order-1">
                            <!-- Filter by Name -->
                            <div class="d-flex align-items-center gap-2">
                                <label class="form-label mb-0 fw-bold">Name:</label>
                                <select class="form-select form-select-sm" style="min-width: 120px;" t-on-change="(e) => { this.onNameFilter(e.target.value); }">
                                    <option value="">All Names</option>
                                    <t t-foreach="state.uniqueNames" t-as="name" t-key="name">
                                        <option t-att-value="name" t-esc="name"></option>
                                    </t>
                                </select>
                            </div>
                            
                            <!-- Filter by Department -->
                            <div class="d-flex align-items-center gap-2">
                                <label class="form-label mb-0 fw-bold">Dept:</label>
                                <select class="form-select form-select-sm" style="min-width: 120px;" t-on-change="(e) => { this.onDepartmentFilter(e.target.value); }">
                                    <option value="">All Departments</option>
                                    <t t-foreach="state.uniqueDepartments" t-as="dept" t-key="dept">
                                        <option t-att-value="dept" t-esc="dept"></option>
                                    </t>
                                </select>
                            </div>
                            
                            <!-- Clear Filters Button -->
                            <button t-if="state.searchTerm || state.departmentFilter" class="btn btn-outline-danger btn-sm" t-on-click="() => this.clearFilters()" title="Clear All Filters">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>
                        
                        <!-- Right: Pagination -->
                        <div class="o_control_panel_navigation d-flex flex-wrap flex-md-nowrap justify-content-end gap-3 order-2">
                            <div class="o_cp_pager text-nowrap" role="search">
                                <nav class="o_pager d-flex gap-2 h-100" aria-label="Pager">
                                    <button class="btn btn-outline-secondary btn-sm" t-on-click="() => this.onPageChange(state.currentPage - 1)" t-att-disabled="state.currentPage === 1">
                                        <i class="fa fa-chevron-left"></i>
                                    </button>
                                    <span class="o_pager_counter align-self-center">
                                        <span class="o_pager_value d-inline-block border-bottom border-transparent mb-n1">
                                            <t t-esc="pagerStart"/>-<t t-esc="pagerEnd"/>
                                        </span>
                                        <span> / </span>
                                        <span class="o_pager_limit"><t t-esc="state.totalRecords"/></span>
                                    </span>
                                    <button class="btn btn-outline-secondary btn-sm" t-on-click="() => this.onPageChange(state.currentPage + 1)" t-att-disabled="state.currentPage === totalPages">
                                        <i class="fa fa-chevron-right"></i>
                                    </button>
                                    <select class="form-select form-select-sm ms-2" style="width: auto;" t-model="state.recordsPerPage" t-on-change="() => { this.state.currentPage = 1; this.loadRecords(); }">
                                        <option value="20">20</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Main Content -->
                <main class="o_content">
                    <div t-if="state.loading" class="d-flex justify-content-center p-4">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    
                    <div t-else="" class="o_list_renderer o_renderer table-responsive" tabindex="-1" style="max-height: 85vh; overflow-y: auto;">
                        <table class="o_list_table table table-sm table-hover position-relative mb-0 o_list_table_ungrouped table-striped" style="table-layout: fixed;">
                            <thead>
                                <tr>
                                    <!-- User Column -->
                                    <th data-tooltip-delay="1000" tabindex="-1" data-name="user_id" class="align-middle o_column_sortable position-relative cursor-pointer opacity-trigger-hover w-print-auto" style="width: 200px;" t-on-click="(ev) => this.onSort('user_id')">
                                        <div class="d-flex align-items-center">
                                            <span class="d-block min-w-0 text-truncate flex-grow-1 flex-shrink-1">User</span>
                                            <i t-attf-class="o_list_sortable_icon fa {{getSortIcon('user_id')}} opacity-0 opacity-100-hover"></i>
                                        </div>
                                    </th>
                                    
                                    <!-- Department Column -->
                                    <th data-tooltip-delay="1000" tabindex="-1" data-name="department_id" class="align-middle o_column_sortable position-relative cursor-pointer opacity-trigger-hover w-print-auto" style="width: 150px;" t-on-click="(ev) => this.onSort('department_id')">
                                        <div class="d-flex align-items-center">
                                            <span class="d-block min-w-0 text-truncate flex-grow-1 flex-shrink-1">Department</span>
                                            <i t-attf-class="o_list_sortable_icon fa {{getSortIcon('department_id')}} opacity-0 opacity-100-hover"></i>
                                        </div>
                                    </th>
                                    
                                    <!-- Position Column -->
                                    <th data-tooltip-delay="1000" tabindex="-1" data-name="position" class="align-middle o_column_sortable position-relative cursor-pointer opacity-trigger-hover w-print-auto" style="width: 130px;" t-on-click="(ev) => this.onSort('position')">
                                        <div class="d-flex align-items-center">
                                            <span class="d-block min-w-0 text-truncate flex-grow-1 flex-shrink-1">Employment Types</span>
                                            <i t-attf-class="o_list_sortable_icon fa {{getSortIcon('position')}} opacity-0 opacity-100-hover"></i>
                                        </div>
                                    </th>
                                    
                                    <!-- Total Tasks Column -->
                                    <th data-tooltip-delay="1000" tabindex="-1" data-name="total_tasks" class="align-middle o_column_sortable position-relative cursor-pointer opacity-trigger-hover w-print-auto text-center" style="width: 100px;" t-on-click="(ev) => this.onSort('total_tasks')">
                                        <div class="d-flex align-items-center justify-content-center">
                                            <span class="d-block min-w-0 text-truncate flex-grow-1 flex-shrink-1">Total Tasks</span>
                                            <i t-attf-class="o_list_sortable_icon fa {{getSortIcon('total_tasks')}} opacity-0 opacity-100-hover"></i>
                                        </div>
                                    </th>
                                    
                                    <!-- Completed Column -->
                                    <th data-tooltip-delay="1000" tabindex="-1" data-name="completed" class="align-middle o_column_sortable position-relative cursor-pointer opacity-trigger-hover w-print-auto text-center" style="width: 100px;" t-on-click="(ev) => this.onSort('completed')">
                                        <div class="d-flex align-items-center justify-content-center">
                                            <span class="d-block min-w-0 text-truncate flex-grow-1 flex-shrink-1">Completed</span>
                                            <i t-attf-class="o_list_sortable_icon fa {{getSortIcon('completed')}} opacity-0 opacity-100-hover"></i>
                                        </div>
                                    </th>
                                    
                                    <!-- In Progress Column -->
                                    <th data-tooltip-delay="1000" tabindex="-1" data-name="in_progress" class="align-middle o_column_sortable position-relative cursor-pointer opacity-trigger-hover w-print-auto text-center" style="width: 100px;" t-on-click="(ev) => this.onSort('in_progress')">
                                        <div class="d-flex align-items-center justify-content-center">
                                            <span class="d-block min-w-0 text-truncate flex-grow-1 flex-shrink-1">In Progress</span>
                                            <i t-attf-class="o_list_sortable_icon fa {{getSortIcon('in_progress')}} opacity-0 opacity-100-hover"></i>
                                        </div>
                                    </th>
                                    
                                    <!-- Not Started Column -->
                                    <th data-tooltip-delay="1000" tabindex="-1" data-name="not_started" class="align-middle o_column_sortable position-relative cursor-pointer opacity-trigger-hover w-print-auto text-center" style="width: 100px;" t-on-click="(ev) => this.onSort('not_started')">
                                        <div class="d-flex align-items-center justify-content-center">
                                            <span class="d-block min-w-0 text-truncate flex-grow-1 flex-shrink-1">Not Started</span>
                                            <i t-attf-class="o_list_sortable_icon fa {{getSortIcon('not_started')}} opacity-0 opacity-100-hover"></i>
                                        </div>
                                    </th>
                                    
                                    <!-- Delayed Column -->
                                    <th data-tooltip-delay="1000" tabindex="-1" data-name="delayed" class="align-middle o_column_sortable position-relative cursor-pointer opacity-trigger-hover w-print-auto text-center" style="width: 100px;" t-on-click="(ev) => this.onSort('delayed')">
                                        <div class="d-flex align-items-center justify-content-center">
                                            <span class="d-block min-w-0 text-truncate flex-grow-1 flex-shrink-1">Delayed</span>
                                            <i t-attf-class="o_list_sortable_icon fa {{getSortIcon('delayed')}} opacity-0 opacity-100-hover"></i>
                                        </div>
                                    </th>
                                    
                                    <!-- Plan Column -->
                                    <th data-tooltip-delay="1000" tabindex="-1" data-name="plan" class="align-middle o_column_sortable position-relative cursor-pointer opacity-trigger-hover w-print-auto text-center" style="width: 100px;" t-on-click="(ev) => this.onSort('plan')">
                                        <div class="d-flex align-items-center justify-content-center">
                                            <span class="d-block min-w-0 text-truncate flex-grow-1 flex-shrink-1">Plan</span>
                                            <i t-attf-class="o_list_sortable_icon fa {{getSortIcon('plan')}} opacity-0 opacity-100-hover"></i>
                                        </div>
                                    </th>
                                    
                                    <!-- Avg Progress Column -->
                                    <th data-tooltip-delay="1000" tabindex="-1" data-name="avg_progress" class="align-middle o_column_sortable position-relative cursor-pointer opacity-trigger-hover w-print-auto text-center" style="width: 150px;" t-on-click="(ev) => this.onSort('avg_progress')">
                                        <div class="d-flex align-items-center justify-content-center">
                                            <span class="d-block min-w-0 text-truncate flex-grow-1 flex-shrink-1">Avg Progress (%)</span>
                                            <i t-attf-class="o_list_sortable_icon fa {{getSortIcon('avg_progress')}} opacity-0 opacity-100-hover"></i>
                                        </div>
                                    </th>
                                    
                                    <!-- Overdue Column -->
                                    <th data-tooltip-delay="1000" tabindex="-1" data-name="overdue" class="align-middle o_column_sortable position-relative cursor-pointer opacity-trigger-hover w-print-auto text-center" style="width: 100px;" t-on-click="(ev) => this.onSort('overdue')">
                                        <div class="d-flex align-items-center justify-content-center">
                                            <span class="d-block min-w-0 text-truncate flex-grow-1 flex-shrink-1">Overdue</span>
                                            <i t-attf-class="o_list_sortable_icon fa {{getSortIcon('overdue')}} opacity-0 opacity-100-hover"></i>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            
                            <tbody class="ui-sortable">
                                <t t-foreach="state.records" t-as="record" t-key="record.id">
                                    <tr class="o_data_row" t-att-data-id="'datapoint_' + record.id">
                                        
                                        <!-- User -->
                                        <td class="o_data_cell o_field_cell o_list_many2one" data-tooltip-delay="1000" tabindex="-1" name="user_id" t-att-data-tooltip="record.user_id and record.user_id[1]" t-esc="record.user_id and record.user_id[1]"></td>
                                        
                                        <!-- Department -->
                                        <td class="o_data_cell o_field_cell o_list_many2one" data-tooltip-delay="1000" tabindex="-1" name="department_id" t-att-data-tooltip="record.department_id and record.department_id[1]" t-esc="record.department_id and record.department_id[1]"></td>
                                        
                                        <!-- Position -->
                                        <td class="o_data_cell o_field_cell o_list_char" data-tooltip-delay="1000" tabindex="-1" name="position" t-att-data-tooltip="record.position || ''" t-esc="record.position || ''"></td>
                                        
                                        <!-- Total Tasks -->
                                        <td class="o_data_cell o_field_cell o_list_number text-center" data-tooltip-delay="1000" tabindex="-1" name="total_tasks" t-esc="record.total_tasks"></td>
                                        
                                        <!-- Completed -->
                                        <td class="o_data_cell o_field_cell o_list_number text-center" data-tooltip-delay="1000" tabindex="-1" name="completed" t-esc="record.completed"></td>
                                        
                                        <!-- In Progress -->
                                        <td class="o_data_cell o_field_cell o_list_number text-center" data-tooltip-delay="1000" tabindex="-1" name="in_progress" t-esc="record.in_progress"></td>
                                        
                                        <!-- Not Started -->
                                        <td class="o_data_cell o_field_cell o_list_number text-center" data-tooltip-delay="1000" tabindex="-1" name="not_started" t-esc="record.not_started"></td>
                                        
                                        <!-- Delayed -->
                                        <td class="o_data_cell o_field_cell o_list_number text-center" data-tooltip-delay="1000" tabindex="-1" name="delayed" t-esc="record.delayed"></td>
                                        
                                        <!-- Plan -->
                                        <td class="o_data_cell o_field_cell o_list_number text-center" data-tooltip-delay="1000" tabindex="-1" name="plan" t-esc="record.plan"></td>
                                        
                                        <!-- Avg Progress -->
                                        <td class="o_data_cell o_field_cell o_progressbar_cell text-center" data-tooltip-delay="1000" tabindex="-1" name="avg_progress" t-att-data-progress="record.avg_progress">
                                            <div class="js-progress-content"></div>
                                        </td>
                                        
                                        <!-- Overdue -->
                                        <td class="o_data_cell o_field_cell o_list_number text-center" data-tooltip-delay="1000" tabindex="-1" name="overdue" t-esc="record.overdue"></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </main>
            </div>
        </div>
    </t>
</templates>